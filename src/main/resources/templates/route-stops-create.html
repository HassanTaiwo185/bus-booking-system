<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Configure Route Stops | Bus System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-check-input:checked { background-color: #198754; border-color: #198754; }
        .bg-success-subtle { background-color: #e8f5e9 !important; }
    </style>
</head>
<body class="bg-light">

<div class="container mt-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-success fw-bold mb-0">Configure Route Sequence</h2>
        <a href="/admin-dashboard" class="btn btn-outline-success d-flex align-items-center shadow-sm">
            <span class="me-2">&larr;</span> Back to Dashboard
        </a>
    </div>

    <div th:if="${error}" class="alert alert-danger shadow-sm border-start border-5 border-danger" th:text="${error}"></div>
    <div th:if="${success}" class="alert alert-success shadow-sm border-start border-5 border-success" th:text="${success}"></div>

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
            <form method="get" action="/route-stops/create">
                <label class="form-label fw-bold text-dark">Step 1: Select Journey Route</label>
                <select name="routeId" class="form-select form-select-lg" onchange="this.form.submit()" required>
                    <option value="">-- Choose a Route --</option>
                    <option th:each="route : ${routes}"
                            th:value="${route.id}"
                            th:text="${route.routeName}"
                            th:selected="${route.id == routeStop.routeId}">
                    </option>
                </select>
                <div class="form-text mt-2">Selecting a route will load available bus stops.</div>
            </form>
        </div>
    </div>

    <form th:if="${routeStop.routeId != null}"
          th:action="@{/route-stops}"
          th:object="${routeStop}"
          method="post">

        <input type="hidden" th:field="*{routeId}"/>

        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-success fw-bold">Step 2: Assign Stops in Sequence</h5>
            </div>
            <div class="card-body p-4">
                <div class="row row-cols-1 row-cols-md-2 g-3">
                    <div th:each="stop, i : ${stops}" class="col">
                        <div class="form-check p-3 rounded border hover-shadow transition-all bg-white">
                            <input class="form-check-input ms-0 me-3"
                                   type="checkbox"
                                   th:id="'stop' + ${stop.id}"
                                   th:name="stops[__${i.index}__].stopId"
                                   th:value="${stop.id}"/>
                            <label class="form-check-label fw-medium"
                                   th:for="'stop' + ${stop.id}"
                                   th:text="${stop.stopName}">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="alert bg-success-subtle text-success mt-4 mb-0 small">
                    <strong>Note:</strong> Saving new stops will automatically archive the previous stop sequence for this route.
                </div>
            </div>

            <div class="card-footer bg-light p-4 text-end">
                <button type="submit" class="btn btn-success btn-lg px-5 shadow-sm">
                    Confirm & Save Sequence
                </button>
            </div>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>